{% extends "admin/layout.html" %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="max-w-5xl mx-auto p-4 md:p-8 animate-fade-in-up">
    <div class="mb-10 text-center md:text-left">
        <h2 class="text-3xl md:text-4xl font-extrabold text-white tracking-tight">
            Configuración de <span class="text-sky-500">Empresa</span>
        </h2>
        <p class="text-slate-400 mt-2">Gestiona la identidad, comunicaciones y licenciamiento de tu negocio.</p>
    </div>
    
    <form action="{{ url_for('admin.configurar_empresa') }}" method="POST" class="space-y-8">
        
<div class="bg-slate-800/40 backdrop-blur-md p-6 md:p-8 rounded-[2rem] border border-white/10 shadow-2xl">
    <div class="flex items-center gap-3 mb-8">
        <div class="w-10 h-10 rounded-full bg-sky-500/20 flex items-center justify-center text-sky-500">
            <i class="fa-solid fa-building"></i>
        </div>
        <h3 class="text-xl font-bold text-white">Información Institucional</h3>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
        <div class="space-y-2 group">
            <label class="block text-slate-400 text-sm font-medium ml-1 group-focus-within:text-sky-400 transition-colors">Razón Social</label>
            <input type="text" name="nombre" value="{{ empresa.emp_razon_social or '' }}" 
                   class="w-full bg-slate-900/60 border border-white/5 rounded-2xl px-5 py-3 text-white outline-none focus:border-sky-500/50 focus:ring-4 focus:ring-sky-500/10 transition-all placeholder:text-slate-600">
        </div>

        <div class="space-y-2 group">
            <label class="block text-slate-400 text-sm font-medium ml-1 group-focus-within:text-sky-400 transition-colors">NIT / Identificación Fiscal</label>
            <input type="text" name="nit" value="{{ empresa.emp_nit or '' }}" 
                   class="w-full bg-slate-900/60 border border-white/5 rounded-2xl px-5 py-3 text-white outline-none focus:border-sky-500/50 focus:ring-4 focus:ring-sky-500/10 transition-all">
        </div>

        <div class="space-y-2 group">
            <label class="block text-slate-400 text-sm font-medium ml-1 group-focus-within:text-sky-400 transition-colors">Dirección Principal</label>
            <input type="text" name="direccion" value="{{ empresa.emp_direccion or '' }}" 
                   class="w-full bg-slate-900/60 border border-white/5 rounded-2xl px-5 py-3 text-white outline-none focus:border-sky-500/50 focus:ring-4 focus:ring-sky-500/10 transition-all">
        </div>

        <div class="space-y-2 group">
            <label class="block text-slate-400 text-sm font-medium ml-1 group-focus-within:text-sky-400 transition-colors">Correo Electrónico Público</label>
            <input type="email" name="email" value="{{ empresa.emp_email or '' }}" 
                   class="w-full bg-slate-900/60 border border-white/5 rounded-2xl px-5 py-3 text-white outline-none focus:border-sky-500/50 focus:ring-4 focus:ring-sky-500/10 transition-all">
        </div>

        <div class="space-y-2 group">
            <label class="block text-slate-400 text-sm font-medium ml-1 group-focus-within:text-sky-400 transition-colors">Teléfono de Contacto (WhatsApp)</label>
            <input type="text" name="telefono" value="{{ empresa.emp_telefono or '' }}" 
                   placeholder="Ej: 573185861444"
                   class="w-full bg-slate-900/60 border border-white/5 rounded-2xl px-5 py-3 text-white outline-none focus:border-sky-500/50 focus:ring-4 focus:ring-sky-500/10 transition-all placeholder:text-slate-600">
        </div>
    </div>
</div>

        <div class="bg-slate-800/40 backdrop-blur-md p-6 md:p-8 rounded-[2rem] border border-white/10 shadow-2xl relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-sky-500/5 blur-3xl"></div>
            
            <div class="flex items-center gap-3 mb-8">
                <div class="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-400">
                    <i class="fa-solid fa-envelope-open-text"></i>
                </div>
                <h3 class="text-xl font-bold text-white">Configuración de Correo (SMTP)</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                <div class="space-y-2">
                    <label class="block text-slate-400 text-sm font-medium ml-1">Servidor de Salida</label>
                    <input type="text" name="smtp_servidor" value="{{ empresa.emp_servidor_smtp or '' }}" placeholder="smtp.gmail.com"
                           class="w-full bg-slate-950/40 border border-white/5 rounded-2xl px-5 py-3 text-white outline-none focus:border-purple-500/50 transition-all">
                </div>
                <div class="space-y-2">
                    <label class="block text-slate-400 text-sm font-medium ml-1">Puerto</label>
                    <input type="text" name="smtp_puerto" value="{{ empresa.emp_puerto_smtp or '' }}" placeholder="465"
                           class="w-full bg-slate-950/40 border border-white/5 rounded-2xl px-5 py-3 text-white outline-none focus:border-purple-500/50 transition-all">
                </div>
                <div class="space-y-2">
                    <label class="block text-slate-400 text-sm font-medium ml-1">Usuario / Cuenta</label>
                    <input type="text" name="smtp_cuenta" value="{{ empresa.emp_cuenta_smtp or '' }}" 
                           class="w-full bg-slate-950/40 border border-white/5 rounded-2xl px-5 py-3 text-white outline-none focus:border-purple-500/50 transition-all">
                </div>
                <div class="space-y-2">
                    <label class="block text-slate-400 text-sm font-medium ml-1">Contraseña de Aplicación</label>
                    <input type="password" name="smtp_clave" value="{{ empresa.emp_clave_smtp or '' }}" placeholder="••••••••••••"
                           class="w-full bg-slate-950/40 border border-white/5 rounded-2xl px-5 py-3 text-white outline-none focus:border-purple-500/50 transition-all">
                </div>
            </div>
            
            <button type="button" onclick="probarSMTP()" 
                    class="mt-8 group flex items-center justify-center gap-2 text-purple-400 hover:text-white transition-all text-sm font-semibold">
                <div class="w-8 h-8 rounded-full border border-purple-500/30 flex items-center justify-center group-hover:bg-purple-500 group-hover:border-purple-500 transition-all">
                    <i class="fa-solid fa-paper-plane text-[10px]"></i>
                </div>
                PROBAR CONEXIÓN SMTP
            </button>
        </div>

        <div class="bg-slate-900/80 p-6 md:p-8 rounded-[2rem] border border-yellow-500/20 shadow-2xl relative overflow-hidden group/lic">
            <div id="unlock-glow" class="absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 transition-opacity duration-700 pointer-events-none"></div>

            <div class="flex items-center justify-between mb-8 relative z-10">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-yellow-500/20 flex items-center justify-center text-yellow-500">
                        <i class="fa-solid fa-shield-halved"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white">Licencia de Uso</h3>
                </div>
                <span id="badge-lock" class="text-[10px] font-black bg-red-500/10 text-red-500 px-4 py-1.5 rounded-full border border-red-500/20 uppercase tracking-widest shadow-[0_0_15px_rgba(239,68,68,0.1)]">
                    <i class="fa-solid fa-lock mr-2"></i>SISTEMA BLOQUEADO
                </span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 relative z-10">
                <div class="space-y-2">
                    <label class="block text-slate-500 text-sm font-medium ml-1">Clave Desarrollador</label>
                    <div class="relative">
                        <input type="password" id="input_unlock" name="clave_autorizacion" placeholder="Ingrese clave para editar" 
                               class="w-full bg-slate-950 border border-white/10 rounded-2xl px-5 py-3 text-white outline-none focus:border-yellow-500 transition-all">
                        <i id="lock-icon" class="fa-solid fa-key absolute right-4 top-4 text-slate-700 transition-colors"></i>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="block text-slate-500 text-sm font-medium ml-1">Capacidad De Empleados
                    </label>
                    <input type="number" name="max_usuarios" id="field_max_usuarios" value="{{ empresa.emp_max_usuarios or 1 }}" readonly
                           class="w-full bg-slate-950/50 border border-white/5 rounded-2xl px-5 py-3 text-slate-600 outline-none cursor-not-allowed transition-all font-mono text-lg">
                </div>

                <div class="space-y-2">
                    <label class="block text-slate-500 text-sm font-medium ml-1">Plan de Suscripción</label>
                    <select name="plan" id="field_plan" disabled
                            class="w-full bg-slate-950/50 border border-white/5 rounded-2xl px-5 py-3 text-slate-600 outline-none cursor-not-allowed transition-all appearance-none font-bold">
                        <option value="Básico" {% if empresa.emp_tipo_plan == 'Básico' %}selected{% endif %}>Básico</option>
                        <option value="profesional" {% if empresa.emp_tipo_plan == 'profesional' %}selected{% endif %}>Profesional</option>
                        <option value="avanzado" {% if empresa.emp_tipo_plan == 'avanzado' %}selected{% endif %}>Avanzado</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="pt-4">
            <button type="submit" 
                    class="w-full bg-gradient-to-r from-sky-600 to-sky-500 hover:from-sky-500 hover:to-sky-400 text-white font-black py-5 rounded-[2rem] shadow-[0_20px_40px_-15px_rgba(14,165,233,0.3)] transition-all active:scale-[0.97] tracking-widest uppercase text-sm">
                Sincronizar Cambios de Configuración
            </button>
        </div>
        
    </form>
</div>

<style>
    @keyframes fade-in-up {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in-up { animation: fade-in-up 0.6s ease-out forwards; }
    
    input:focus, select:focus {
        background-color: rgba(15, 23, 42, 0.8) !important;
    }
</style>

<script>
    window.URL_TEST_SMTP = "{{ url_for('admin.test_smtp') }}";
</script>

<script src="{{ url_for('static', filename='js/empresa.js') }}"></script>
{% endblock %}